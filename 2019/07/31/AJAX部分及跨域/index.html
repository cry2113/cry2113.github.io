<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.9.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="yanm1ng&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      AJAX部分及跨域 | Hexo
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
    css('css/plugins/gitment.css')
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    <script src="/js/qrious.js"></script>
  
  
    <script src="/js/gitment.js"></script>
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


</head>
<div class="wechat-share">
  <img src="/css/images/logo.png">
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Hexo</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>AJAX部分及跨域</h2>
  <p class="post-date">2019-07-31</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h1 id="XML介绍"><a href="#XML介绍" class="headerlink" title="XML介绍"></a>XML介绍</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">XML是一种数据格式，是一种可拓展的标记语(标签可自定义，如:&lt;student&gt;&lt;/student&gt;)，xml文件需要使用浏览器内置的xml解析器解析。(XML相对json使用相对复杂，但相对严谨)</span><br><span class="line"></span><br><span class="line">XML的组成：标签、属性、注释、文档声明</span><br><span class="line"></span><br><span class="line">用途：1、多用于设计和严谨的数据结构  </span><br><span class="line">	 2、用于作为配置文件</span><br></pre></td></tr></table></figure>

<h2 id="1-使用"><a href="#1-使用" class="headerlink" title="1.使用"></a>1.使用</h2><h3 id="1-1标签体"><a href="#1-1标签体" class="headerlink" title="1.1标签体"></a>1.1标签体</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">多数使用方法与规则和HTML相同。</span><br><span class="line">//注意点</span><br><span class="line">1）xml标签名称区分大小写。</span><br><span class="line">2）xml标签一定要正确配对。</span><br><span class="line">3）xml标签名中间不能使用空格</span><br><span class="line">4）xml标签名不能以数字开头</span><br></pre></td></tr></table></figure>

<h3 id="1-2属性"><a href="#1-2属性" class="headerlink" title="1.2属性"></a>1.2属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;student name=&quot;eric&quot;&gt;student&lt;/student&gt;</span><br><span class="line">1）属性值必须以引号包含，可以是单引号也可以双引号，但是不能单双引号混用！！！</span><br><span class="line">2）一个标签内可以有多个属性，但不能出现重复的属性名</span><br></pre></td></tr></table></figure>

<h3 id="1-3注释及文档说明"><a href="#1-3注释及文档说明" class="headerlink" title="1.3注释及文档说明"></a>1.3注释及文档说明</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//注释</span><br><span class="line">&lt;!--  xml注释 --&gt;</span><br><span class="line"></span><br><span class="line">//文档说明</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">1) version: xml的版本号</span><br><span class="line">2) encoding： 解析xml文件时查询的码表（解码过程时查询的码表）</span><br><span class="line"></span><br><span class="line">js文件中写xml文档时：</span><br><span class="line">var xml = &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">来进行文档说明</span><br><span class="line">之后可对xml使用拼接字符串的方式书写xml文档。</span><br><span class="line">如：  </span><br><span class="line">	 xml += &apos;&lt;person&gt;&apos;;</span><br><span class="line">	 xml += &apos;&lt;name&gt;羊杨&lt;/name&gt;&apos;;</span><br><span class="line">	 xml += &apos;&lt;age&gt;16&lt;/age&gt;&apos;;</span><br><span class="line">	 xml += &apos;&lt;gender&gt;男&lt;/gender&gt;&apos;;</span><br><span class="line">	 xml += &apos;&lt;/person&gt;&apos;;</span><br></pre></td></tr></table></figure>

<h3 id="1-4服务器给客户端返回XML"><a href="#1-4服务器给客户端返回XML" class="headerlink" title="1.4服务器给客户端返回XML"></a>1.4服务器给客户端返回XML</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">服务器端需要设置响应头为：application/xml</span><br><span class="line">res.header(&quot;Content-Type&quot;,&quot;application/xml&quot;);</span><br><span class="line"></span><br><span class="line">客户端使用 responseXML 来获取服务器返回的XML数据，</span><br><span class="line">操作方式（例如：筛选标签体）通过DOM方式操作</span><br></pre></td></tr></table></figure>

<h3 id="1-5服务器给客户端返回JSON"><a href="#1-5服务器给客户端返回JSON" class="headerlink" title="1.5服务器给客户端返回JSON"></a>1.5服务器给客户端返回JSON</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">由于JSON是基于key：value格式的数据类型。</span><br><span class="line">服务器返回数据时需用 var str = JSON.stringify(data) 将data的格式转为字符串格式返回。</span><br><span class="line"></span><br><span class="line">客户端接收时若需要JSON格式的数据时使用：</span><br><span class="line">JSON.parse(str)</span><br><span class="line">将数据格式转为JSON</span><br></pre></td></tr></table></figure>

<h3 id="1-6服务器返回数据在模板引擎的渲染"><a href="#1-6服务器返回数据在模板引擎的渲染" class="headerlink" title="1.6服务器返回数据在模板引擎的渲染"></a>1.6服务器返回数据在模板引擎的渲染</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;table id=&quot;demo&quot;&gt;&lt;/table&gt;</span><br><span class="line">    //引入前端的art-template插件</span><br><span class="line">    &lt;script src=&quot;template-web.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    //定义模板</span><br><span class="line">    &lt;script id=&quot;tmpl&quot; type=&quot;text/x-art-template&quot;&gt;</span><br><span class="line">        &#123;&#123;each comments&#125;&#125;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">          &lt;td&gt;&#123;&#123;$value.author&#125;&#125;&lt;/td&gt;</span><br><span class="line">          &lt;td&gt;&#123;&#123;$value.content&#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &#123;&#123;/each&#125;&#125;</span><br><span class="line">      &lt;/script&gt;</span><br><span class="line"></span><br><span class="line">     &lt;script&gt;</span><br><span class="line">        //获取ajax的核心对象</span><br><span class="line">        var xhr = new XMLHttpRequest()</span><br><span class="line"></span><br><span class="line">        xhr.open(&apos;GET&apos;, &apos;http://localhost:3000/getJson&apos;)</span><br><span class="line">        xhr.send()</span><br><span class="line">        xhr.onreadystatechange = function () &#123;</span><br><span class="line">          if (this.readyState !== 4) return</span><br><span class="line">          var res = JSON.parse(this.responseText)</span><br><span class="line"></span><br><span class="line">          // 模板所需数据</span><br><span class="line">          var context = &#123; comments: res.data &#125;</span><br><span class="line">          // 借助模板引擎的API 渲染数据</span><br><span class="line">          var html = template(&apos;tmpl&apos;, context)</span><br><span class="line">          console.log(html)</span><br><span class="line"></span><br><span class="line">          document.getElementById(&apos;demo&apos;).innerHTML = html</span><br><span class="line">        &#125;</span><br><span class="line">     &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-AJAX-请求封装"><a href="#2-AJAX-请求封装" class="headerlink" title="2.AJAX 请求封装"></a>2.AJAX 请求封装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 发送一个 AJAX 请求</span><br><span class="line">* @param &#123;String&#125; method 请求方法</span><br><span class="line">* @param &#123;String&#125; url 请求地址</span><br><span class="line">* @param &#123;Object&#125; params 请求参数</span><br><span class="line">* @param &#123;Function&#125; done 请求完成过后需要做的事情（委托/回调）</span><br><span class="line">*/</span><br><span class="line">function ajax (method, url, params, done) &#123;</span><br><span class="line">    method = method.toUpperCase()</span><br><span class="line">    var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject(&apos;Microsoft.XMLHTTP&apos;)</span><br><span class="line">    if (typeof params === &apos;object&apos;) &#123;</span><br><span class="line">        var tempArr = []</span><br><span class="line">        for (var key in params) &#123;</span><br><span class="line">            var value = params[key]</span><br><span class="line">            tempArr.push(key + &apos;=&apos; + value)</span><br><span class="line">        &#125;</span><br><span class="line">        params = tempArr.join(&apos;&amp;&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">    if (method === &apos;GET&apos;) &#123;</span><br><span class="line">        url += &apos;?&apos; + params</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.open(method, url, true)</span><br><span class="line">    var data = null</span><br><span class="line">    if (method === &apos;POST&apos;) &#123;</span><br><span class="line">        xhr.setRequestHeader(&apos;Content-Type&apos;, &apos;application/x-www-form-urlencoded&apos;)</span><br><span class="line">        data = params</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.onreadystatechange = function () &#123;</span><br><span class="line">        if (this.readyState !== 4) return</span><br><span class="line">        // 不应该在封装的函数中主观的处理响应结果</span><br><span class="line">        // console.log(this.responseText)</span><br><span class="line">        // 你说我太主观，那么你告诉我应该做什么</span><br><span class="line">        done(this.responseText)</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.send(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var onDone = function (res) &#123;</span><br><span class="line">    console.log(res)</span><br><span class="line">    console.log(&apos;做完了&apos;)</span><br><span class="line">&#125;</span><br><span class="line">ajax(&apos;get&apos;, &apos;http://localhost:3000/getTime&apos;, &#123;&#125;, onDone)</span><br></pre></td></tr></table></figure>

<h2 id="3-jQuery中的AJAX"><a href="#3-jQuery中的AJAX" class="headerlink" title="3.jQuery中的AJAX"></a>3.jQuery中的AJAX</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用：$.ajax(&#123;&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-1常用参数"><a href="#3-1常用参数" class="headerlink" title="3.1常用参数"></a>3.1常用参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">url：请求地址</span><br><span class="line">type：请求方法，默认为 get</span><br><span class="line">dataType：服务端响应数据类型</span><br><span class="line">contentType：请求体内容类型，默认 application/x-www-form-urlencoded</span><br><span class="line">data：需要传递到服务端的数据，如果 GET 则通过 URL 传递，如果 POST 则通过请求体传递</span><br><span class="line">timeout：请求超时时间</span><br><span class="line"></span><br><span class="line">//请求的回调函数</span><br><span class="line">beforeSend：请求发起之前触发</span><br><span class="line">success：请求成功之后触发（响应状态码 200；入参 res）</span><br><span class="line">error：请求失败触发</span><br><span class="line">complete：请求完成触发（不管成功与否）</span><br></pre></td></tr></table></figure>

<h3 id="3-2dataType（详）"><a href="#3-2dataType（详）" class="headerlink" title="3.2dataType（详）"></a>3.2dataType（详）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//1.通过dataType选项还可以指定其他不同数据处理方式。可以指定 html、json、jsonp、       script或者text。</span><br><span class="line"></span><br><span class="line">//2.其中，text和xml类型返回的数据不会经过处理。数据仅仅简单的将XMLHttpRequest的	responseText或responseXML属性传递给success回调函数，</span><br><span class="line"></span><br><span class="line">//3.如果指定为html类型，返回HTML文本，包含的script标签会在插入DOM时执行</span><br><span class="line"></span><br><span class="line">//4.如果指定script类型的话，把响应的结果当作JavaScript 执行，并将其当作纯文本返回</span><br><span class="line"></span><br><span class="line">//5.如果指定为json类型，则会把获取到的数据作为一个JavaScript对象来解析，并且把构建	  好的对象作为结果返回。为了实现这个目的，他首先尝试使用JSON.parse()。如果浏览器     不支持，则使用一个函数来构建。JSON数据是一种能很方便通过JavaScript解析的结构化     数据。</span><br><span class="line"></span><br><span class="line">//6.如果获取的数据文件存放在远程服务器上（域名不同，也就是跨域获取数据），则需要使用     jsonp类型。会自动在所请求的URL最后添加&quot;?callback=?&quot;。服务器端应当在JSON数据前     加上回调函数名，以便完成一个有效的JSONP请求。</span><br><span class="line"></span><br><span class="line">&apos;注意：我们必须确保网页服务器的响应头与我们选择的dataType所匹配。比如说，dataType为XML的话，服务器端就必须声明 text/xml 或者 application/xml 来获得一致的结果&apos;</span><br></pre></td></tr></table></figure>

<h3 id="3-3全局的事件处理"><a href="#3-3全局的事件处理" class="headerlink" title="3.3全局的事件处理"></a>3.3全局的事件处理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$(document).ajaxStrat(function()&#123;&#125;)</span><br><span class="line">$(document).ajaxStop(function()&#123;&#125;)</span><br><span class="line"></span><br><span class="line">nprogress的使用: （页面中有ajax请求就执行）</span><br><span class="line">$(document).ajaxStart(function () &#123;</span><br><span class="line">    NProgress.start()</span><br><span class="line">&#125;).ajaxStop(function () &#123;</span><br><span class="line">    NProgress.done()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h1><h2 id="1-概念"><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">同源策略是浏览器的一种安全策略，所谓同源是指  **域名，协议，端口完全相同** ，只有同源的地址才可以相互通过AJAX 的方式请求。</span><br><span class="line">同源或者不同源说的是两个地址之间的关系，域名，协议，端口三者有任何一个不同的地址之间请求我们称之为跨域请求</span><br></pre></td></tr></table></figure>

<h2 id="2-解决方法"><a href="#2-解决方法" class="headerlink" title="2.解决方法"></a>2.解决方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">JSONP</span><br><span class="line">CORS</span><br><span class="line">代理服务器</span><br><span class="line">修改document.domain</span><br><span class="line">Iframe</span><br><span class="line">Location.hash</span><br><span class="line">Window.postMessage()</span><br><span class="line">Websocket</span><br><span class="line">等方法</span><br></pre></td></tr></table></figure>

<h3 id="2-1JSONP"><a href="#2-1JSONP" class="headerlink" title="2.1JSONP"></a>2.1JSONP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">JSONP的实质其实就是通过页面上的script标签中的src属性进行跨域的请求</span><br><span class="line"></span><br><span class="line">var script = document.createElement(&apos;script&apos;)</span><br><span class="line">script.src = &apos;http://localhost:3000/testJsonP?callback=&apos; + funcName</span><br><span class="line">document.body.appendChild(script)</span><br><span class="line"></span><br><span class="line">//JSONP存在的问题：</span><br><span class="line">1.JSONP需要服务端配合，服务端按照客户端的要求返回一段JavaScript调用客户端的函数</span><br><span class="line">2.只能发送GET请求</span><br><span class="line"></span><br><span class="line">注意：JSONP用的是script标签，和AJAX提供的XMLHttpRequest没有任何关系！！！</span><br></pre></td></tr></table></figure>

<h4 id="2-1-1JSONP的封装"><a href="#2-1-1JSONP的封装" class="headerlink" title="2.1.1JSONP的封装"></a>2.1.1JSONP的封装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">实质就是将定义函数的函数名拎出去另外定义（以防函数名写死，造成代码移植困难）</span><br><span class="line">function jsonp (url, params, callback) &#123;</span><br><span class="line">    //随机生成一个方法</span><br><span class="line">    var funcName = &apos;jsonp_&apos; + Date.now() + Math.random().toString().substr(2, 5)</span><br><span class="line">    </span><br><span class="line">    if (typeof params === &apos;object&apos;) &#123;</span><br><span class="line">        var tempArr = []</span><br><span class="line">        for (var key in params) &#123;</span><br><span class="line">            var value = params[key]</span><br><span class="line">            tempArr.push(key + &apos;=&apos; + value)</span><br><span class="line">        &#125;</span><br><span class="line">        params = tempArr.join(&apos;&amp;&apos;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var script = document.createElement(&apos;script&apos;)</span><br><span class="line">    script.src = url + &apos;?&apos; + params + &apos;&amp;callback=&apos; + funcName</span><br><span class="line">    document.body.appendChild(script)</span><br><span class="line"></span><br><span class="line">    window[funcName] = function (data) &#123;</span><br><span class="line">        callback(data)</span><br><span class="line">        delete window[funcName]</span><br><span class="line">        document.body.removeChild(script)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//使用</span><br><span class="line">jsonp(&apos;http://localhost:3000/testJsonP&apos;, &#123; id: 123 &#125;, function (res) &#123;</span><br><span class="line">    console.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2jQuery中JSONP的使用"><a href="#2-1-2jQuery中JSONP的使用" class="headerlink" title="2.1.2jQuery中JSONP的使用"></a>2.1.2jQuery中JSONP的使用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//发送ajax请求(将dataType设置为jsonp即可)</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	  $.ajax(&#123;</span><br><span class="line">        url: &apos;http://localhost:3000/finduser&apos;,</span><br><span class="line">        dataType: &apos;jsonp&apos;,</span><br><span class="line">        success: function (res) &#123;</span><br><span class="line">            console.log(res)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">//server.js</span><br><span class="line">app.get(&quot;/finduser&quot;,function(req,res)&#123;</span><br><span class="line">	 //获取jQuery中的封装的回调函数名</span><br><span class="line">	 var callback = req.query.callback;</span><br><span class="line">	 var data = &apos;[&#123;name:&quot;张三&quot;,gender:&quot;男&quot;&#125;,&#123;name:&quot;李四&quot;,gender:&quot;女&quot;&#125;]&apos;;</span><br><span class="line">	 if (!callback) &#123;</span><br><span class="line">	 	 res.header(&quot;Content-Type&quot;, &quot;application/json; charset=utf-8&quot;);</span><br><span class="line">	 	 res.end(data)</span><br><span class="line">	 &#125;</span><br><span class="line">	 console.log(callback);</span><br><span class="line">	 //返回响应前要设置好jsonp对应的响应头</span><br><span class="line">	 res.header(&quot;Content-Type&quot;, &quot;application/javascript&quot;);</span><br><span class="line">	 res.send(`typeof $&#123;callback&#125; === &apos;function&apos; &amp;&amp; $&#123;callback&#125;($&#123;data&#125;)`);;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="2-2CORS"><a href="#2-2CORS" class="headerlink" title="2.2CORS"></a>2.2CORS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cross Origin Resource Share，跨域资源共享。这种方案无需客户端作出任何变化（客户端不用改代码），只是在被请求的服务端响应的时候添加一个 Access- Control-Allow-Origin 的响应头，表示这个资源是否允许指定域请求。</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//使用（无脑抄在服务器端，客户端不用改写或加写任何内容）</span><br><span class="line">app.all(&apos;*&apos;, function(req, res, next) &#123;</span><br><span class="line">    console.log(req.method);</span><br><span class="line">    res.header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span><br><span class="line">    res.header(&apos;Access-Control-Allow-Headers&apos;, &apos;Content-type&apos;);</span><br><span class="line">    res.header(&quot;Access-Control-Allow-Methods&quot;, &quot;PUT,POST,GET,DELETE,OPTIONS,PATCH&quot;);</span><br><span class="line">    res.header(&apos;Access-Control-Max-Age&apos;,6000);//预请求缓存10分钟</span><br><span class="line">    next();  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</section>
    <!-- Tags START -->
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2019/07/31/Redux/">
        <span class="nav-arrow">← </span>
        
          Redux
        
      </a>
    
    
      <a class="nav-right" href="/2019/08/29/RN开发环境配置/">
        
          (untitled)
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
      <div class="money-like">
        <div class="reward-btn">
          赏
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>使用支付宝打赏</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>使用微信打赏</b>
            </span>
          </span>
        </div>
        <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
      </div>
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Gitment START -->
      <div id="comments"></div>
      <!-- Gitment END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#XML介绍"><span class="toc-nav-text">XML介绍</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#1-使用"><span class="toc-nav-text">1.使用</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-1标签体"><span class="toc-nav-text">1.1标签体</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-2属性"><span class="toc-nav-text">1.2属性</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-3注释及文档说明"><span class="toc-nav-text">1.3注释及文档说明</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-4服务器给客户端返回XML"><span class="toc-nav-text">1.4服务器给客户端返回XML</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-5服务器给客户端返回JSON"><span class="toc-nav-text">1.5服务器给客户端返回JSON</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-6服务器返回数据在模板引擎的渲染"><span class="toc-nav-text">1.6服务器返回数据在模板引擎的渲染</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-AJAX-请求封装"><span class="toc-nav-text">2.AJAX 请求封装</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#3-jQuery中的AJAX"><span class="toc-nav-text">3.jQuery中的AJAX</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-1常用参数"><span class="toc-nav-text">3.1常用参数</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-2dataType（详）"><span class="toc-nav-text">3.2dataType（详）</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-3全局的事件处理"><span class="toc-nav-text">3.3全局的事件处理</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#跨域"><span class="toc-nav-text">跨域</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#1-概念"><span class="toc-nav-text">1.概念</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-解决方法"><span class="toc-nav-text">2.解决方法</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-1JSONP"><span class="toc-nav-text">2.1JSONP</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-1-1JSONP的封装"><span class="toc-nav-text">2.1.1JSONP的封装</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-1-2jQuery中JSONP的使用"><span class="toc-nav-text">2.1.2jQuery中JSONP的使用</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-2CORS"><span class="toc-nav-text">2.2CORS</span></a></li></ol></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://yoursite.com/2019/07/31/AJAX部分及跨域/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>


  <script>
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });
  </script>



  <script>
    var gitmentConfig = "yanm1ng";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "AJAX部分及跨域",
        owner: "yanm1ng",
        repo: "yanm1ng.github.io",
        oauth: {
          client_id: "0f87e490e00ee3fd87ef",
          client_secret: "4a9d2b148e7971c2201ad12131ce8bf8159ccd2e"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  </script>




    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2019 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  </body>
</html>